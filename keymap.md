# 初识Atom(4) —— keymap快捷键设置

# 目录
- [修改快捷键](#修改快捷键)
- [添加快捷键](#添加快捷键)
- [移除快捷键](#移除快捷键)

![][2]

首先需要了解一下快捷键的组成，如图中共分四部分，快捷键(Keystroke) + 执行命令(Command) + 来源(Source) + 选择器(Selector)<br />
若要配置我们自己的快捷键，需要打开`File-Keymap...`文件，如下图：

![][8]

文件内我们需要注意的只是该图中，红框标注的部分，灰色显示的两个快捷键设置，为该软件给的示例设置方式，高亮的则为起作用的快捷键设置，前方不加`#`。基础的快捷键设置包含3个部分：
```
 'atom-text-editor':
    'enter': 'editor:newline'
```
- 第一行'atom-text-editor'是Selector（选择器）所代表的内容，即触发这个快捷键的区域
- 第二行'enter'是Keystroke（快捷键）所代表的内容，即按键
- 第二行'editor:newline'是Command（执行命令）所代表的内容，即要触发的命令（可以在 Ctrl+Shift+P 中看到准确的命令名）
- 三者之间都有一个`:`隔开
- 格式必须遵守如此的两行格式，以及第二行必须比上一行多一个缩进，否则会报错

## 修改快捷键
这里以开发者工具为例，通常在浏览器里打开开发者工具快捷键为`F12`,而这里是`Alt+Ctrl+I`，假设用户已经习惯了`F12`,所以想把这里的快捷键也改为`F12`,那么你需要做以下几步：

1. 搜索`F12`是否已被占用，在搜索条键入`f12`，不区分大小写（这里不是`F12`键~），默认情况下，此键是没有被占用的。
2. 搜索`Alt+Ctrl+I`组合键，这里需要注意的是，在搜索组合键时，连字符不是`+`,而是`-`,即要搜索此组合键时，键入的是`Alt-Ctrl-I`,你会发现还是搜索不到，原因是，组合键的顺序是错误的，正确顺序该是`Ctrl-Alt-I`,好了！搜索出来了！
3. 准备工作完成，在[初识Atom(2) —— 菜单栏][9]一节中`packages`部分`Keybinding Resolver —— 密钥绑定解析器`插件，已经讲到atom编辑器对快捷键解析的优先级问题，而这里的`keymap`文件设置的快捷键，它的权重，大于一切！~

4. 那么知道了这些，我们需要修改一个快捷键时，可以复制上面的模式，将Selector（选择器）以及Command（执行命令）改成body及window:toggle-dev-tools，然后将快捷键设置成`F12`即可
    ```
    'body':
        'f12': 'window:toggle-dev-tools'
    ```
5. 设置完成后保存，直接按`F12`，效果实现，快捷键已经绑定成功,这个时候去`Settings-keybindings`中是搜索不到`F12`这个快捷方式的，需要重新启动该编辑器才能在列表中显示，也才能搜索。

## 添加快捷键
修改快捷知道了，那么如果一个命令本身没有快捷键该如何添加呢？快捷键列表中，并不会列出没有设置快捷键的命令，那该如何知道他的选择器及执行命令呢？<br />
我们曾在[初识Atom(2) —— 菜单栏][9]View(视图)-其他分类中讲到过`Toggle Command Palette`快捷键为`Ctrl+Shift+P`,打开命令面板,这里有所有的命令，不管有没有设置快捷键，都可以找到。

接下来以显示/隐藏菜单栏为例，我想为这个命令设置一个快捷键，方便平时的操作：

1. 我们打开命令面板,输入命令关键词`toggle menu bar`,三个单词任输入一个即可，找到了该命令,其左侧显示为：window:Toggle Menu Bar,命令面板即命令显示列表，这里就是快捷键设置中最后一个单引号内所代表的内容。
2. 我想用`Alt-q`做为这个命令的快捷键，那么第二行的两个内容就已经全部确定
3. 快捷键设置第一行是选择器，即触发这个快捷键的区域，这个可以查看快捷键列表中的选择器，可以看到选择器针对对象有针对插件本身、有针对body、有针对电脑系统等等，我们不需要了解更多，我们需要的是针对这个编辑器就可以了，使用body就可以，大部分用户自定义的快捷键，都可以直接针对body.那么新添加的命令快捷键写法就出来了，如下：

    ```
     'body':
        'alt-q': 'window:toggle-menu-bar'
    ```

- 注意一：所有单词都必须是小写，如果快捷键以及命令是多单词的话，都必须是用`-`将多单词连接起来。
- 注意二：同一个选择器下的所有命令需要写在一起，添加快捷键及修改快捷键中，我们所针对的选择器都是`body`,所以，这里两条快捷键设置都需要写在这个选择器下面，即：

    ```
    'body':
        'f12': 'window:toggle-dev-tools'
        'alt-q': 'window:toggle-menu-bar'
    ```

- 注意三：所有针对同一个选择器的，都必须写在一起，如上，如将每个命令都分开写，每个命令都加一遍选择器，则只会执行最后一个。

## 移除快捷键
上文中，我们为开发者工具设置了新的快捷键命令`f12`,但是如果你继续使用`ctrl-alt-i`，将依然会打开开发者工具，那么如果我想让这个快捷键命令不再是打开开发者工具的命令呢？

我们可以：
```
通过上述修改和添加快捷键的方式将这个快捷键组合，赋予其他命令。
```
当然，这里要讲的是另外一种方法 —— 移除快捷键：

当键表系统遇到了以`unset!`作为快捷键的命令，它就会像没有绑定匹配到当前键位序列一样，继续从它的父节点中寻找。如果你想移除一个你不再用到的快捷键，例如Atom核心中的或者包中的快捷键，应该直接使用`unset!`。

例如我们想将打开开发者工具的初始命令`ctrl-alt-i`移除，则写法如下：
```
'body':
    'ctrl-alt-i': 'unset!'
```
![][10]

如上图，在设置之后，keymap列表中，此快捷键命令并不会被注销，而是还存在着，只是多了一个用户自定义，其命令为`unset!`，此时再使用`ctrl-alt-i`快捷键，便无任何响应了。

![][11]

上图为具体快捷键命令设置在keymap文件中的写法，针对body的所有命令都写在body这个选择器之下。


***

[2]:https://github.com/kaivin/atom/raw/master/images/settings/keybindings.png "快捷键设置"
[8]:https://github.com/kaivin/atom/raw/master/images/settings/keymap.png "keymap文件"
[9]:/menuBar.md "菜单栏"
[10]:https://github.com/kaivin/atom/raw/master/images/settings/keymap1.png "keymap文件"
[11]:https://github.com/kaivin/atom/raw/master/images/settings/keymap2.png "keymap文件"
